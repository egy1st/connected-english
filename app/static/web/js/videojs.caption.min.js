/*! videojs-caption - v0.4.0 - 2014-12-18
* Copyright (c) 2014 ; Licensed  */
!function(a){function b(a,b){return a>b.endTime?1:a<b.startTime?-1:0}function c(a,b){a.removeClass("position-HB position-HT position-VR position-VL align-C align-L"),a.addClass(b.position?"position-"+b.position:"position-HB"),a.addClass(b.alignment?"align-"+b.alignment:"align-C")}function d(a){for(var b=/<R.+?value=[\"'](.+?)[\"']>(.+?)<\/R>/gi;m=b.exec(a);)a=a.replace(m[0],"<ruby>"+m[2]+"<rt>"+m[1]+"</rt></ruby>");return a}function e(a){for(var b=/<G>(.+?)<\/G>/gi;m=b.exec(a);)a=a.replace(m[0],"<G class='group-tags'>"+m[1]+"</G>");return a}function f(f){function k(){w=[],x=0,s(),u=!1,v=n(0),z.captionType===h&&(c(w[0],{position:"HB",alignment:"C"}),w[0].empty()),u?q(0,!0):o(),B.on("timeupdate",function(){ct=1e3*this.currentTime(),m(ct)})}function l(){for(var a=0;x>a;a++)q(a,!0)}function m(a){if(u)return v=n(a),u?void l():void o();var c=y[v];0==b(a,c)||(a>c.endTime&&a-c.endTime<500?(v++,v>y.length-1&&(u=!0)):v=n(a),u?l():o())}function n(a){for(var c,d,e=0,f=y.length-1;f>=e;)if(c=Math.ceil((e+f)/2),d=b(a,y[c]),1==d)e=c+1;else{if(-1!=d){for(u=!1;c>0&&0==b(a,y[c-1]);)c--;return c}f=c-1}u=!0}function o(){z.captionType==g?r():z.captionType==h&&p()}function p(){w[0].css("visibility","visible");var b=y[v];w[0].find(".vjs-caption-overlay-text").length>=i&&w[0].find(".vjs-caption-overlay-text")[0].remove();var c=d(b.data);c=e(c);var f=a("<span class='vjs-caption-overlay-text'><span></span></span>").css(z.captionStyle);f.find("span").html(c).addClass("caption-font-size-"+z.captionSize),w[0].append(f),x=1,z.onCaptionChange(v)}function q(a,b){b?w[a].css("visibility","hidden"):w[a].css("visibility","visible")}function r(){for(var a=1;;){var b=y[v];b.data?q(a-1,!1):q(a-1,!0),c(w[a-1],b);var f=d(b.data);if(f=e(f),w[a-1].find(".vjs-caption-overlay-text span").html(f),v<y.length-1&&(b.startTime!=y[v+1].startTime||b.endTime!=y[v+1].endTime))break;if(a++,v++,a>w.length&&s(),v>y.length-1){u=!0;break}}for(;x>a;)q(x-1,!0),x--;x=a,z.onCaptionChange(v)}function s(){var b=a("<div class='vjs-caption-overlay'><span class='vjs-caption-overlay-text'><span></span></span></div>");b.find(".vjs-caption-overlay-text").css(z.captionStyle),w.push(b),A.append(b),t()}function t(){A.find(".vjs-caption-overlay-text span").each(function(){a(this).removeClass().addClass("caption-font-size-"+z.captionSize)})}var u,v,w,x,y=f.data,z=a.extend(!0,{},j,f.setting),A=a(this.el()),B=this;B.caption={updateCaption:function(a){v=n(ct),o(),a&&a()},loadNewCaption:function(){B.pause().currentTime(0),y=newCaption.data,v=0,u=!1,o()},getRowCursorID:function(){return v},getCaptionData:function(){return y},increaseFontSize:function(){z.captionSize=(z.captionSize+1)%9,t()},decreaseFontSize:function(){z.captionSize--,z.captionSize<0&&(z.captionSize=8),t()},changeToRollUp:function(){for(z.captionType=h,c(w[0],{position:"HB",alignment:"C"}),w[0].empty();x>1;)w[x-1].css("visibility","hidden"),x--},changeToPopOn:function(){z.captionType=g;for(var a=w[0].find(".vjs-caption-overlay-text").length;a>1;)w[0].find(".vjs-caption-overlay-text")[0].remove(),a--}},k()}var g="pop-on",h="roll-up",i=3,j={captionSize:4,captionStyle:{"background-color":"rgba(255,0,0,0.8)",color:"white",padding:"3px"},onCaptionChange:function(){},captionType:g};videojs.plugin("caption",f)}(jQuery);